# Notes on ProposerVM Design

## Fork Handling

Upon ProposerVM creation you need to specify an activation time following which blocks generated by the coreVm will be wrapped into proposer block and the congestion mechanism will kick in. Technically the fork process is handled as follows:

* All the blocks generated by a ProposerVM are of type proposerVM.ProposerBlock, whether they come before or after the fork. The proposerVM.ProposerBlock blocks implement the snowman.Block interface, hence they can be smoothly processed by the engine. Post-fork proposer blocks have the core block decorated with a header, while pre-fork proposer blocks serialize exactly as the core blocks do and have the same block ID. The proposerVM.ProposerBlock allow to extend verification of core blocks and handle, among other things, forks.
* The following rule is enforced: each proposerBlock, pre-fork or post-fork, whose timestamp follows activation time, must have its progeny made up of post-fork only blocks. The rule is enforced in ProposerBlock.Verify() call.
* As soon as a pre-fork block is accepted whose timestamp follows activation time, pre-fork blocks won't be verify anymore
